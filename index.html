<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æœƒå“¡èª¿æŸ¥è¡¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 640px; margin: auto; }
    h2 { color: #333; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    .section-title { margin-top: 2rem; font-size: 1.2rem; color: #555; }
    .submit { margin-top: 2rem; background: #06c; color: #fff; padding: 10px 20px; border: none; border-radius: 5px; }
    #debug { margin-top: 2rem; color: red; font-size: 0.9rem; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>æœƒå“¡èª¿æŸ¥è¡¨</h2>

  <form id="surveyForm">
    <input type="hidden" id="userId" name="userId">

    <!-- âœ… Part 1ï¼šåŸºæœ¬èƒŒæ™¯ -->
    <div class="section-title">åŸºæœ¬èƒŒæ™¯</div>

    <label>é›»è©±ï¼š</label>
    <input type="text" id="phone" required>

    <label>å¹´é½¡ï¼š</label>
    <input type="radio" name="age" value="25æ­²ä»¥ä¸‹"> 25æ­²ä»¥ä¸‹
    <input type="radio" name="age" value="26-45æ­²"> 26-45æ­²
    <input type="radio" name="age" value="46æ­²ä»¥ä¸Š"> 46æ­²ä»¥ä¸Š

    <label>æ€§åˆ¥ï¼š</label>
    <input type="radio" name="gender" value="ç”·"> ç”·
    <input type="radio" name="gender" value="å¥³"> å¥³
    <input type="radio" name="gender" value="å…¶ä»–"> å…¶ä»–

    <label>å±…ä½åœ°ï¼š</label>
    <input type="radio" name="region" value="ä¸­å£¢å€"> ä¸­å£¢å€
    <input type="radio" name="region" value="å…¶ä»–"> å…¶ä»–

    <!-- âœ… Part 2ï¼šè³¼è²·ç¿’æ…£èª¿æŸ¥ -->
    <div class="section-title">è³¼è²·ç¿’æ…£èª¿æŸ¥</div>

    <label>å¤šä¹…è³¼è²·ä¸€æ¬¡éºµåŒ…ï¼Ÿ</label>
    <input type="radio" name="buyFreq" value="æ¯é€±3æ¬¡ä»¥ä¸Š"> æ¯é€±3æ¬¡ä»¥ä¸Š
    <input type="radio" name="buyFreq" value="æ¯é€±1~3æ¬¡"> æ¯é€±1~3æ¬¡
    <input type="radio" name="buyFreq" value="å¶çˆ¾"> å¶çˆ¾

    <label>é€šå¸¸åœ¨å“ªè£¡è³¼è²·ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰</label>
    <input type="checkbox" name="buyPlace" value="éºµåŒ…åº—"> éºµåŒ…åº—
    <input type="checkbox" name="buyPlace" value="ä¾¿åˆ©å•†åº—"> ä¾¿åˆ©å•†åº—
    <input type="checkbox" name="buyPlace" value="é‡è²©è¶…å¸‚"> é‡è²©è¶…å¸‚
    <input type="checkbox" name="buyPlace" value="ç¶²è³¼"> ç¶²è³¼

    <label>è³¼è²·æ™‚é–“ï¼Ÿ</label>
    <input type="radio" name="buyTime" value="ä¸‹åˆ"> ä¸‹åˆ
    <input type="radio" name="buyTime" value="æ™šä¸Š"> æ™šä¸Š

    <label>å“ªä¸€é¤åƒéºµåŒ…ï¼Ÿ</label>
    <input type="radio" name="buyMeal" value="æ—©é¤"> æ—©é¤
    <input type="radio" name="buyMeal" value="é»å¿ƒ"> é»å¿ƒ
    <input type="radio" name="buyMeal" value="å…¶ä»–"> å…¶ä»–

    <!-- âœ… Part 3ï¼šé¸æ“‡è€ƒé‡ -->
    <div class="section-title">é¸æ“‡è€ƒé‡</div>

    <label>ä½ é‡è¦–å“ªäº›ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰</label>
    <input type="checkbox" name="buyConcern" value="åƒ¹æ ¼"> åƒ¹æ ¼
    <input type="checkbox" name="buyConcern" value="ç„¡æ·»åŠ ç‰©é£Ÿæ"> ç„¡æ·»åŠ ç‰©é£Ÿæ
    <input type="checkbox" name="buyConcern" value="å£å‘³"> å£å‘³
    <input type="checkbox" name="buyConcern" value="è£½ä½œéç¨‹"> è£½ä½œéç¨‹
    <input type="checkbox" name="buyConcern" value="å‰µæ–°å“é …"> å‰µæ–°å“é …
    <input type="checkbox" name="buyConcern" value="å¤–è§€"> å¤–è§€

    <label>é¡˜æ„å¤šä»˜å¤šå°‘ï¼Ÿ</label>
    <input type="radio" name="extraPay" value="10%ä»¥ä¸‹"> 10%ä»¥ä¸‹
    <input type="radio" name="extraPay" value="11%-20%"> 11%-20%
    <input type="radio" name="extraPay" value="ä¾é£Ÿææˆæœ¬å®šåƒ¹"> ä¾é£Ÿææˆæœ¬å®šåƒ¹

    <label>ä½ å–œæ­¡çš„å“é …ï¼ˆå¯è¤‡é¸ï¼‰ï¼š</label>
    <input type="checkbox" name="bakeFav" value="åå¸ç³»åˆ—"> åå¸ç³»åˆ—
    <input type="checkbox" name="bakeFav" value="å°å¼æ—¥å¼éºµåŒ…"> å°å¼æ—¥å¼éºµåŒ…
    <input type="checkbox" name="bakeFav" value="æ­å¼éºµåŒ…"> æ­å¼éºµåŒ…
    <input type="checkbox" name="bakeFav" value="æ³•åœ‹éºµåŒ…"> æ³•åœ‹éºµåŒ…
    <input type="checkbox" name="bakeFav" value="ä¸¹éº¥å¯é Œ"> ä¸¹éº¥å¯é Œ
    <input type="checkbox" name="bakeFav" value="è²æœç³»åˆ—"> è²æœç³»åˆ—
    <input type="checkbox" name="bakeFav" value="ç„¡éº©è³ªéºµåŒ…"> ç„¡éº©è³ªéºµåŒ…
    <input type="checkbox" name="bakeFav" value="è›‹ç³•orç”œé»"> è›‹ç³•orç”œé»
    <input type="checkbox" name="bakeFav" value="é¤…ä¹¾orä¼´æ‰‹ç¦®"> é¤…ä¹¾orä¼´æ‰‹ç¦®
    <input type="checkbox" name="bakeFav" value="å…¶ä»–"> å…¶ä»–

    <label>ä½ å–œæ­¡çš„å£å‘³ï¼ˆå¯è¤‡é¸ï¼‰ï¼š</label>
    <input type="checkbox" name="tasteFav" value="åŸå‘³"> åŸå‘³
    <input type="checkbox" name="tasteFav" value="é¹¹å£å‘³"> é¹¹å£å‘³
    <input type="checkbox" name="tasteFav" value="ç”œå£å‘³"> ç”œå£å‘³

    <label>ä½ åœ¨æ„æˆåˆ†æ˜¯å¦å¤©ç„¶ï¼Ÿ</label>
    <input type="radio" name="natural" value="éå¸¸åœ¨æ„"> éå¸¸åœ¨æ„
    <input type="radio" name="natural" value="ä¸åœ¨æ„"> ä¸åœ¨æ„

    <!-- âœ… Part 4ï¼šé–‹æ”¾å¼ -->
    <div class="section-title">æ„è¦‹èˆ‡å»ºè­°</div>

    <label>ä½ æœ€å–œæ­¡çš„éºµåŒ…/è›‹ç³•æ˜¯ä»€éº¼ï¼Ÿ</label>
    <textarea id="favBread" rows="2"></textarea>

    <label>æœ‰æ²’æœ‰ä½ å¾ˆå¸¸æ‰¾ä½†å¸‚é¢ä¸Šå¾ˆå°‘è¦‹çš„éºµåŒ…/è›‹ç³•ï¼Ÿ</label>
    <textarea id="rareBread" rows="2"></textarea>

    <button class="submit" type="submit">é€å‡ºè¡¨å–®</button>
  </form>

  <div id="debug"></div>

  <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // â† ä¿®æ”¹ç‚ºä½ çš„ Apps Script URL

    async function main() {
      try {
        await liff.init({ liffId: 'YOUR_LIFF_ID' }); // â† æ›¿æ›ç‚ºä½ çš„ LIFF ID

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        const userId = profile.userId;
        document.getElementById('userId').value = userId;
        document.getElementById('debug').innerHTML += `<div><b>userId:</b> ${userId}</div>`;

        document.getElementById('surveyForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const debugEl = document.getElementById('debug');
          debugEl.innerHTML = '';

          const data = {
            userId,
            phone: document.getElementById('phone').value,
            age: getRadioValue('age'),
            gender: getRadioValue('gender'),
            region: getRadioValue('region'),
            buyFreq: getRadioValue('buyFreq'),
            buyPlace: getCheckboxValues('buyPlace'),
            buyTime: getRadioValue('buyTime'),
            buyMeal: getRadioValue('buyMeal'),
            buyConcern: getCheckboxValues('buyConcern'),
            extraPay: getRadioValue('extraPay'),
            bakeFav: getCheckboxValues('bakeFav'),
            tasteFav: getCheckboxValues('tasteFav'),
            natural: getRadioValue('natural'),
            favBread: document.getElementById('favBread').value,
            rareBread: document.getElementById('rareBread').value
          };

          try {
            const res = await fetch(GOOGLE_SCRIPT_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });

            const rawText = await res.text();
            let result;
            try {
              result = JSON.parse(rawText);
            } catch (jsonErr) {
              debugEl.innerHTML += `
                <div><b>âŒ ç„¡æ³•è§£æå›å‚³ JSONï¼š</b> ${jsonErr.message}</div>
                <div><b>å›å‚³åŸå§‹å…§å®¹ï¼š</b><pre>${rawText}</pre></div>
              `;
              return;
            }

            debugEl.innerHTML += `<div><b>âœ… å›å‚³ç‹€æ…‹ç¢¼ï¼š</b> ${res.status}</div>`;
            debugEl.innerHTML += `<div><b>âœ… å›å‚³çµæœï¼š</b><pre>${JSON.stringify(result, null, 2)}</pre></div>`;

            if (res.ok && result.status === 'success') {
              alert('æäº¤æˆåŠŸï¼æ„Ÿè¬ä½ çš„å¡«å¯« ğŸ‰');
            } else {
              alert('âš ï¸ æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }

          } catch (err) {
            debugEl.innerHTML = `
              <div><b>âŒ æäº¤éŒ¯èª¤ï¼š</b> ${err.message}</div>
              <div><b>ğŸ” åŸå§‹éŒ¯èª¤ç‰©ä»¶ï¼š</b><pre>${JSON.stringify(err, null, 2)}</pre></div>
            `;
            alert('âš ï¸ æäº¤æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æŸ¥çœ‹ä¸‹æ–¹éŒ¯èª¤å€å¡Š');
          }
        });
      } catch (outerErr) {
        document.getElementById('debug').innerHTML = `<div><b>âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š</b> ${outerErr.message}</div>`;
        console.error('LIFF Error', outerErr);
      }
    }

    function getRadioValue(name) {
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      return selected ? selected.value : '';
    }

    function getCheckboxValues(name) {
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);
    }

    main();
  </script>
</body>
</html>
